<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114年駕駛及隨車人員幼童車研習考題</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f7f6; margin: 0; padding: 20px; color: var(--primary); line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); border-bottom: 2px solid var(--secondary); padding-bottom: 15px; margin-bottom: 25px; font-size: 1.6em; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .btn { cursor: pointer; padding: 15px 24px; border: none; border-radius: 8px; transition: 0.3s; font-size: 16px; margin: 5px; font-weight: bold; }
        .btn-primary { background: var(--secondary); color: white; width: 100%; margin: 20px 0; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { border: 1px solid var(--secondary); background: transparent; color: var(--secondary); }
        .timer { font-size: 1.2em; font-weight: bold; color: var(--danger); text-align: right; margin-bottom: 15px; position: sticky; top: 0; background: white; padding: 10px 0; z-index: 10; }
        .question-box { margin-top: 10px; padding: 20px; border: 1px solid #eee; border-radius: 12px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .option { display: flex; align-items: center; padding: 15px; margin: 12px 0; background: #f9f9f9; border-radius: 8px; cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .option:hover { background: #eef2f7; }
        .option input { width: auto; margin-right: 15px; transform: scale(1.3); }
        .navigation { display: flex; justify-content: space-between; margin-top: 25px; gap: 10px; }
        .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; }
        .result-box { background: #e8f4fd; padding: 20px; border-radius: 12px; margin-bottom: 25px; }
        .explain-item { border-left: 5px solid var(--secondary); padding: 15px; margin-bottom: 20px; background: #fafafa; border-radius: 0 12px 12px 0; }
        .correct { color: var(--success); font-weight: bold; }
        .wrong { color: var(--danger); font-weight: bold; }
        @media (max-width: 600px) {
            body { padding: 10px; }
            .container { padding: 15px; border-radius: 0; }
            h1 { font-size: 1.3em; }
            .navigation { flex-direction: column; }
            .option { font-size: 1.1em; padding: 18px; }
        }
    </style>
</head>
<body>

<div id="app" class="container">
    <div v-if="isSubmitting" class="loading-overlay">
        <div style="font-size: 24px; font-weight: bold; color: var(--secondary);">📝 成績同步中...</div>
        <p>請稍候，完成後將自動跳轉至成績單</p>
    </div>
    
    <h1>114年駕駛及隨車人員幼童車研習考題</h1>

    <div v-if="stage === 'setup' && !isSubmitting">
        <div class="form-group"><label>姓名</label><input v-model="user.name" placeholder="請輸入姓名"></div>
        <div class="form-group"><label>服務之幼兒園</label><input v-model="user.school" placeholder="請輸入幼兒園名稱"></div>
        <div class="form-group">
            <label>身分</label>
            <select v-model="user.role">
                <option value="">請選擇身分</option>
                <option value="駕駛人員">駕駛人員</option>
                <option value="隨車人員">隨車人員</option>
            </select>
        </div>
        <div style="background: #fff9db; padding: 20px; border-radius: 8px; margin-bottom: 10px; font-size: 0.95em;">
            <strong>⚠️ 注意事項：</strong><br>
            • 限時 60 分鐘，中途關閉視窗將不計分。<br>
            • 點擊「確認繳交」後成績會即時傳送到後台。<br>
            • 建議使用 Chrome 或 Safari 瀏覽器以確保 PDF 下載功能正常。
        </div>
        <button class="btn btn-primary" @click="startQuiz">進入測驗</button>
    </div>

    <div v-if="stage === 'quiz' && !isSubmitting">
        <div class="timer">⏳ 剩餘：{{ formatTime(timeLeft) }}</div>
        <div class="question-box">
            <div style="color: #666; font-size: 0.9em; margin-bottom: 5px;">進度：{{ currentIdx + 1 }} / 34</div>
            <h3 style="margin-top: 0; font-size: 1.2em;">{{ currentQuestion.q }}</h3>
            <div class="options-container">
                <label v-for="(opt, key) in currentQuestion.options" :key="key" class="option">
                    <input type="radio" :name="'q'+currentIdx" :value="key" v-model="userAnswers[currentIdx]">
                    <span>({{key}}) {{ opt }}</span>
                </label>
            </div>
        </div>
        <div class="navigation no-print">
            <button class="btn btn-outline" @click="prev" :disabled="currentIdx === 0">上一題</button>
            <button class="btn btn-outline" @click="next" v-if="currentIdx < 33">下一題</button>
            <button class="btn btn-success" @click="confirmSubmit" v-else>確認繳交</button>
        </div>
    </div>

    <div v-if="stage === 'result'" id="result-content">
        <div class="result-box">
            <h2 style="margin-top: 0; color: var(--secondary); text-align: center;">🏆 測驗評量報告</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><strong>姓名：</strong>{{ user.name }}</div>
                <div><strong>單位：</strong>{{ user.school }}</div>
                <div><strong>身分：</strong>{{ user.role }}</div>
                <div><strong>得分：</strong><span style="font-size: 1.4em; color: var(--danger);">{{ score }} 分</span></div>
                <div style="grid-column: span 2;"><strong>完成時間：</strong>{{ finishDate }} (耗時 {{ usedTimeText }})</div>
            </div>
        </div>

        <div class="no-print" style="text-align: center; margin-bottom: 30px;">
            <button class="btn btn-primary" style="max-width: 300px;" @click="downloadPDF($event)">⬇ 下載 PDF 成績紀錄</button>
        </div>

        <h3>📚 題目解析檢討</h3>
        <div v-for="(q, index) in allQuestions" :key="index" class="explain-item">
            <p><strong>{{ index + 1 }}. {{ q.q }}</strong></p>
            <p>您的答案：<span :class="userAnswers[index] === q.ans ? 'correct' : 'wrong'">{{ userAnswers[index] || '未答' }}</span> 
               | 正解：<span class="correct">{{ q.ans }}</span></p>
            <p style="color: #666; font-size: 0.9em;"><strong>解析：</strong>{{ q.desc }}</p>
        </div>
    </div>
</div>

<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzTGeIo3z8t_k1fHlcEWr8UOTU5lwZHJ3kO_ABlpzTaE0PBQ1vojm7X-FP13XYuXjI/exec'; // 請務必確認這裡有貼對

const { createApp } = Vue;
createApp({
    data() {
        return {
            stage: 'setup',
            isSubmitting: false,
            user: { name: '', school: '', role: '' },
            timeLeft: 3600,
            timer: null,
            currentIdx: 0,
            userAnswers: new Array(34).fill(null),
            score: 0,
            usedTimeText: '',
            finishDate: '',
            allQuestions: [
                { q: "根據《幼兒園幼童專用車輛與其駕駛人及隨車人員督導管理辦法》，幼童專用車的出廠年限不得超過幾年？", options: {A: "五年", B: "八年", C: "十年", D: "十二年"}, ans: "C", desc: "依據管理辦法第 4 條，幼童專用車車齡不得逾出廠十年，逾期應予汰換。" },
                { q: "依《幼兒教育及照顧法》，幼兒園使用幼童專用車載運幼兒時，每幾位幼兒至少應配置隨車人員一人？", options: {A: "十人", B: "十五人", C: "二十人", D: "二十五人"}, ans: "C", desc: "根據幼教法及管理辦法第 13 條，每二十人至少應配置隨車人員一人。" },
                { q: "根據《臺北市學生及幼兒交通車管理自治條例》，新購置的幼童專用車應符合什麼條件？", options: {A: "出廠五年內之二手車", B: "出廠一年內及第一次領牌之新車", C: "只要車齡在十年內皆可", D: "不限出廠年份，經檢驗合格即可"}, ans: "B", desc: "依臺北市自治條例第 4 條，應購置出廠日起一年內且第一次領牌之新車。" },
                { q: "幼童專用車之駕駛人，到職時應附多久時間內的健康檢查報告？", options: {A: "三個月內", B: "六個月內", C: "一年內", D: "兩年內"}, ans: "C", desc: "管理辦法第 11 條規定，應附一年內之健檢報告。" },
                { q: "幼兒園應將幼童專用車之行車路線報請哪一個單位備查？", options: {A: "警察局交通大隊", B: "交通部公路總局", C: "直轄市、縣（市）主管機關（教育局/局處）", D: "行政院教育部"}, ans: "C", desc: "管理辦法第 9 條規定，應報直轄市、縣（市）主管機關備查。" },
                { q: "幼童專用車載運幼兒時，法規對行駛路段有何限制？", options: {A: "不得行駛快速道路", B: "不得行駛高速公路", C: "不得行駛市區主要幹道", D: "不得行駛隧道"}, ans: "B", desc: "管理辦法第 9 條規定，載運幼兒時不得行駛高速公路。" },
                { q: "幼童專用車駕駛人每次行車前，應確實檢查哪些設備並留存紀錄？", options: {A: "車況、滅火器、安全門及安全設備", B: "僅需檢查油量與水箱", C: "僅需檢查輪胎胎紋", D: "每週檢查一次即可"}, ans: "A", desc: "管理辦法第 12 條要求每次行前檢查關鍵安全設備。" },
                { q: "幼童專用車的行前檢查紀錄及檢修紀錄，至少應留存多久以備檢查？", options: {A: "三個月", B: "半年", C: "一年", D: "三年"}, ans: "C", desc: "管理辦法第 12 條規定，紀錄至少應留存一年。" },
                { q: "依《幼兒教育及照顧法》，若幼兒園使用未經核准之幼童專用車，最高可處多少罰鍰？", options: {A: "一萬元", B: "三萬元", C: "十萬元", D: "五十萬元"}, ans: "B", desc: "依幼教法相關罰則，處三千元至三萬元罰鍰。" },
                { q: "隨車人員於每次幼兒上下車時，應如何確保幼兒安全？", options: {A: "僅需口頭詢問", B: "請駕駛人代點名", C: "依乘坐名冊逐一清點並留存紀錄", D: "免清點"}, ans: "C", desc: "管理辦法第 13 條規定應逐一清點並留存紀錄。" },
                { q: "根據《臺北市學生及幼兒交通車管理自治條例》，幼童專用車駕駛人應定期接受何種訓練？", options: {A: "進階駕駛訓練", B: "交通安全及緊急救護演練相關訓練", C: "車輛維修訓練", D: "不需訓練"}, ans: "B", desc: "自治條例要求定期辦理交通安全及緊急救護教育訓練。" },
                { q: "幼童專用車發生行車事故時，駕駛人及隨車人員首要工作為何？", options: {A: "打電話給園長", B: "立即疏散幼兒", C: "拍照存證", D: "留在原位"}, ans: "B", desc: "管理辦法第 14 條規定，應立即疏散幼兒。" },
                { q: "依《幼兒教育及照顧法》，隨車人員是否可以由年滿 18 歲之志工擔任？", options: {A: "可以", B: "不可以，必須符合法定資格且無消極資格", C: "可以，經園長同意", D: "不限年齡"}, ans: "B", desc: "必須符合法定資格，不得有虐童或性侵等紀錄。" },
                { q: "《臺北市學生及幼兒交通車管理自治條例》規定，幼童專用車外觀應加漆哪些資訊？", options: {A: "園所電話", B: "立案字號、車號、出廠年份及乘載人數", C: "駕駛手機", D: "政府標章"}, ans: "B", desc: "自治條例第 5 條規定應於兩邊外側加漆行政核備資訊。" },
                { q: "幼童專用車之駕駛人，其最高年齡限制為多少歲？", options: {A: "六十歲", B: "六十五歲", C: "七十歲", D: "無限制"}, ans: "B", desc: "依管理辦法第 11 條，原則上不得超過六十五歲。" },
                { q: "若幼童專用車逾期未汰換（超過 10 年），除罰鍰外還會面臨何種處分？", options: {A: "吊銷駕照", B: "沒入車輛", C: "限期改善，屆期未改按次處罰", D: "勒令停業"}, ans: "C", desc: "應限期改善，否則可連續處罰甚至停辦。" },
                { q: "幼兒園幼童專用車的車身顏色應符合哪項標準？", options: {A: "純白色", B: "鮮黃色搭配紅色條紋", C: "亮橘色", D: "自行決定"}, ans: "B", desc: "應依規定使用標準鮮黃色並標示紅色條紋。" },
                { q: "隨車人員在幼兒下車後，最重要的一個動作是什麼？", options: {A: "關門", B: "確認車內已無留置幼兒", C: "畫路線圖", D: "填加油紀錄"}, ans: "B", desc: "必須巡查座位，確保無幼兒遺留。" },
                { q: "依《臺北市學生及幼兒交通車管理自治條例》，交通車駕駛人若患有何種疾病應停止工作？", options: {A: "輕微感冒", B: "足以影響行車及安全之疾病", C: "慢性腰痛", D: "近視"}, ans: "B", desc: "自治條例第 7 條規定，有影響安全之疾病應即停止駕駛。" },
                { q: "幼兒園應將「乘坐幼童專用車幼兒名冊」如何處理？", options: {A: "放園長室", B: "貼車窗", C: "由隨車人員隨身攜帶並落實紀錄", D: "免記錄"}, ans: "C", desc: "名冊應隨車供人員清點並紀錄。" },
                { q: "若幼童專用車駕駛人因故臨時請假，應如何處理代理事宜？", options: {A: "老師代開", B: "園長親自開", C: "聘請具職業執照且符合資格人員代理", D: "志工協助"}, ans: "C", desc: "駕駛人及代理人皆必須具備職業駕駛執照。" },
                { q: "幼兒園更換人員時，應於多久時間內報主管機關備查？", options: {A: "三天內", B: "十五日內", C: "一個月內", D: "學期末"}, ans: "B", desc: "人員異動應於十五日內報請教育局備
